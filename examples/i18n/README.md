# Internationalization

## Introduction

AngularDart templates support internationalization (i18n) via integration with
[`package:intl`][intl].

For each `@i18n`-annotated message in a component template, AngularDart
generates a corresponding `Intl.message()` in the component's generated
`.template.dart` file.

## Syntax

A document fragment can be marked for i18n by applying an `@i18n` annotation to
its parent element. The value of the `@i18n` annotation is used as the message
[description][intl_message] to assist with translation.

```html
<div @i18n="A description.">
  A message to be <i>translated</i>.
</div>
```

For content at the root of your template without a parent element, or a document
fragment that is logically distinct from its siblings, `<ng-container>` can be
used to provide a host for the `@i18n` annotation without affecting layout.

```html
<ng-container @i18n="A description.">
  A message to be <i>translated</i>.
</ng-container>
```

Attributes can be marked for i18n by applying an `@i18n:<attr>` annotation to
the same host element. Inputs on components and directives can be set via this
syntax as well.

```html
<input
    type="text"
    placeholder="Name"
    @i18n:placeholder="Placeholder text on input for writing name.">
```

### Options

*   `@i18n.meaning="..."`

    The value of this annotation sets the [`meaning`][intl_message] parameter,
    which is used to disambiguate identical messages with different meanings.

*   `@i18n.skip`

    The presence of this annotation sets the [`skip`][intl_message] parameter to
    true, which skips this message during extraction.

To apply an option to an internationalized attribute, simply append the
`:<attr>` to the option annotation. For example,
`@i18n.meaning:placeholder="..."` or `@i18n.skip:placeholder`.

## Steps

### Annotate messages

See [`app_component.html`][app_component.html] for examples.

### Build app

Before the `@i18n`-annotated messages can be extracted for translation, their
backing `Intl.message()` calls must be generated by building the app.

```
pub run build_runner build
```

### Extract messages

Use [`intl_translation`][intl_translation] to extract internationalized messages
for translation.

It's important to specify the `--locale` for which the messages have been
written, so that they can be reused for that locale. This example is written in
`en_US`.

```
pub run intl_translation:extract_to_arb \
  --locale en_US \
  --output-dir messages \
  lib/app_component.dart \
  .dart_tool/build/generated/examples.i18n/lib/app_component.template.dart
```

This command will create an Application Resource Bundle (ARB) file
`messages/intl_messages.arb` containing the extracted messages for translation.

Note that all Dart files containing `Intl.message()` calls must be explicitly
listed as arguments in order for their messages to be extracted for translation.
Listing these individually may become tedious for larger projects, so a script
like the following can be used to search for all Dart files in your project.

```
find . -name '*.dart' -print0 | xargs -0 \
  pub run intl_translation:extract_to_arb \
    --locale en_US \
    --output-dir messages
```

#### Extracting messages from dependencies

*Note that the above solution won't find any `Intl.message()` calls in the
source of your dependencies.*

If you depend on a package that defines `Intl.message()` calls in its source,
such as [`package:angular_components`][angular_components], *and* rely on those
messages to be internationalized, you'll have to ensure you list those sources
when running the `extract_to_arb` command. The easiest way to do this is to
specify a `packages` directory within your project root when running `pub get`.

```
pub get --packages-dir packages
```

This generates a directory named `packages` with symbolic links directly to your
dependencies. You can now use `find -L` to include the source of your
dependencies. It's strongly recommended to at least individually specify which
packages to search for Dart files, since the `packages` directory will include
a large number of Dart files.

```
find -L .dart_tool lib packages/angular_components -name '*.dart' -print0 | \
  xargs -0 \
  pub run intl_translation:extract_to_arb \
    --locale en_US \
    --output-dir messages
```

At this point it's worth maintaining your own script to ensure you're extracting
messages only from the desired packages each time.

### Translate messages

Use a translation service of your choice to produce an ARB file for each locale
you wish to support.

### Generate messages

Use [`intl_translation`][intl_translation] again to generate a Dart library
containing the message translations for each locale. In addition to the Dart
files containing `Intl.message()` calls, you must also specify the ARB files
containing translations you produced in the previous step.

```
find . -name '*.dart' -print0 | xargs -0 \
  pub run intl_translation:generate_from_arb \
    --output-dir lib/messages \
    messages/intl_messages.arb
```

### Initialize messages

Import the generated `messages_all.dart` in your app entrypoint and await
`initializeMessages()` before invoking `runApp()`. This example uses
[`findSystemLocale()`][intl_find_system_locale] to set the locale.

```dart
import 'package:examples.i18n/messages/messages_all.dart';
import 'package:intl/intl_browser.dart';

void main() async {
  final locale = await findSystemLocale();
  await initializeMessages(locale);
  runApp(...);
}
```

It's important to await `initializeMessages()` since `@i18n`-annotated messages
are locked to the locale in which they're initialized.  If you wish to change
the locale of `@i18n`-annotated messages after calling `runApp()`, a full reload
is required.

[angular_components]: https://pub.dev/packages/angular_components
[app_component.html]: https://github.com/dart-lang/angular/blob/master/examples/i18n/lib/app_component.html
[intl]: https://pub.dev/packages/intl
[intl_find_system_locale]: https://pub.dev/documentation/intl/latest/intl_browser/findSystemLocale.html
[intl_message]: https://pub.dev/documentation/intl/latest/intl/Intl/message.html
[intl_translation]: https://pub.dev/packages/intl_translation
